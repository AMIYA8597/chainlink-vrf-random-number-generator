// const { ethers } = require("hardhat");
// require("dotenv").config();

// async function main() {
//   const contractAddress = process.env.CONTRACT_ADDRESS;
//   const JackVRFNumberGenerator = await ethers.getContractFactory("JackVRFNumberGenerator");
//   const generator = JackVRFNumberGenerator.attach(contractAddress);

//   console.log("Requesting random numbers...");
//   const tx = await generator.requestRandomWords();
//   console.log("Transaction hash:", tx.hash);
  
//   const receipt = await tx.wait();
  
//   // Get the requestId from the RequestSent event
//   const event = receipt.events.find(event => event.event === "RequestSent");
//   const requestId = event.args[0];
//   console.log("Request ID:", requestId.toString());
  
//   console.log("Waiting for Chainlink VRF response...");
  
//   let fulfilled = false;
//   while (!fulfilled) {
//     await new Promise(resolve => setTimeout(resolve, 5000));
//     try {
//       const [isFulfilled, mainNumbers, additionalNumbers] = await generator.getRequestStatus(requestId);
      
//       if (isFulfilled) {
//         console.log("Main numbers (1-48):", mainNumbers.map(n => n.toString()));
//         console.log("Additional numbers (1-11):", additionalNumbers.map(n => n.toString()));
//         fulfilled = true;
//       }
//     } catch (error) {
//       console.log("Waiting for fulfillment...");
//     }
//   }
// }

// main()
//   .then(() => process.exit(0))
//   .catch((error) => {
//     console.error(error);
//     process.exit(1);
//   });













































const hre = require("hardhat");

async function main() {
    try {
        // Replace with your deployed contract address
        const CONTRACT_ADDRESS = "0xE2A64FC9166E04FB0fA263250f749Df0c456DEc1";

        console.log("Getting contract instance...");
        const Contract = await hre.ethers.getContractFactory("JackVRFNumberGenerator");
        const contract = await Contract.attach(CONTRACT_ADDRESS);

        console.log("Requesting random numbers...");

        const tx = await contract.requestRandomWords({
            gasLimit: 3000000 // Adjusted gas limit
        });

        console.log("Transaction hash:", tx.hash);
        console.log("Waiting for confirmation...");

        const receipt = await tx.wait();
        if (receipt.status === 0) {
            throw new Error("Transaction failed with receipt: " + JSON.stringify(receipt));
        }

        console.log("Transaction confirmed in block:", receipt.blockNumber);

        // Get the requestId from the RequestSent event
        const requestId = receipt.events.find(event => event.event === "RequestSent").args.requestId;
        console.log("Request ID:", requestId.toString());

        // Wait for the random numbers (polling)
        console.log("\nWaiting for Chainlink VRF response (this may take several minutes)...");

        let fulfilled = false;
        let numbers;
        for (let i = 0; i < 20; i++) {
            console.log("Checking request status...");

            [fulfilled, numbers] = await contract.getRequestStatus(requestId);

            if (fulfilled) {
                break;
            }

            await new Promise(r => setTimeout(r, 30000)); // Wait 30 seconds between checks
        }

        if (fulfilled) {
            console.log("\nRandom numbers received!");
            console.log("Numbers (1-48):", numbers.map(n => n.toString()));
        } else {
            console.log("\nDid not receive random numbers after 10 minutes");
        }

    } catch (error) {
        console.error("\nError details:");
        console.error(error);
    }
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.error("Top-level error:", error);
        process.exit(1);
    });














































































































// const hre = require("hardhat");

// async function main() {
//     try {
//         // Replace with your deployed contract address
//         const CONTRACT_ADDRESS = "0xDC88c03Ae9A852D7777a95B7E28dFF7e6bc0ee0d";

//         console.log("Getting contract instance...");
//         const Contract = await hre.ethers.getContractFactory("JackVRFNumberGenerator");
//         const contract = await Contract.attach(CONTRACT_ADDRESS);

//         console.log("Requesting random numbers...");

//         const tx = await contract.requestRandomWords({
//             gasLimit: 3000000 // Adjusted gas limit
//         });

//         console.log("Transaction hash:", tx.hash);
//         console.log("Waiting for confirmation...");

//         const receipt = await tx.wait();
//         if (receipt.status === 0) {
//             throw new Error("Transaction failed with receipt: " + JSON.stringify(receipt));
//         }

//         console.log("Transaction confirmed in block:", receipt.blockNumber);

//         // Get the requestId from the RequestSent event
//         const requestId = receipt.events.find(event => event.event === "RequestSent").args.requestId;
//         console.log("Request ID:", requestId.toString());

//         // Wait for the random numbers (polling)
//         console.log("\nWaiting for Chainlink VRF response (this may take several minutes)...");

//         let fulfilled = false;
//         let mainNumbers, additionalNumbers;
//         for (let i = 0; i < 20; i++) {
//             console.log("Checking request status...");

//             [fulfilled, mainNumbers, additionalNumbers] = await contract.getRequestStatus(requestId);

//             if (fulfilled) {
//                 break;
//             }

//             await new Promise(r => setTimeout(r, 30000)); // Wait 30 seconds between checks
//         }

//         if (fulfilled) {
//             console.log("\nRandom numbers received!");
//             console.log("Main numbers:", mainNumbers.map(n => n.toString()));
//             console.log("Additional numbers:", additionalNumbers.map(n => n.toString()));
//         } else {
//             console.log("\nDid not receive random numbers after 10 minutes");
//         }

//     } catch (error) {
//         console.error("\nError details:");
//         console.error(error);
//     }
// }

// main()
//     .then(() => process.exit(0))
//     .catch((error) => {
//         console.error("Top-level error:", error);
//         process.exit(1);
//     });



































// const hre = require("hardhat");

// async function main() {
//     try {
//         // Replace with your deployed contract address
//         const CONTRACT_ADDRESS = "0xDC88c03Ae9A852D7777a95B7E28dFF7e6bc0ee0d";

//         console.log("Getting contract instance...");
//         const Contract = await hre.ethers.getContractFactory("JackVRFNumberGenerator");
//         const contract = await Contract.attach(CONTRACT_ADDRESS);

//         console.log("Requesting random numbers...");
//         const tx = await contract.requestRandomWords({
//             gasLimit: 3000000 // Adjusted gas limit
//         });

//         console.log("Transaction hash:", tx.hash);
//         console.log("Waiting for confirmation...");

//         const receipt = await tx.wait();
//         if (receipt.status === 0) {
//             throw new Error("Transaction failed with receipt: " + JSON.stringify(receipt));
//         }

//         console.log("Transaction confirmed in block:", receipt.blockNumber);

//         const requestId = await contract.lastRequestId();
//         console.log("Request ID:", requestId.toString());

//         // Wait for the random numbers (polling)
//         console.log("\nWaiting for Chainlink VRF response (this may take several minutes)...");

//         let fulfilled = false;
//         let mainNumbers = [];
//         let additionalNumbers = [];

//         for (let i = 0; i < 20; i++) { // Poll for up to 10 minutes
//             console.log("Checking request status...");
//             const status = await contract.getRequestStatus(requestId);

//             fulfilled = status.fulfilled;
//             if (fulfilled) {
//                 mainNumbers = status.mainNumbers;
//                 additionalNumbers = status.additionalNumbers;
//                 break;
//             }

//             console.log("Not fulfilled yet. Retrying in 30 seconds...");
//             await new Promise(r => setTimeout(r, 30000)); // Wait 30 seconds
//         }

//         if (fulfilled) {
//             console.log("\nRandom numbers received!");
//             console.log("Main Numbers:", mainNumbers.map(n => n.toString()));
//             console.log("Additional Numbers:", additionalNumbers.map(n => n.toString()));
//         } else {
//             console.log("\nDid not receive random numbers after 10 minutes");
//         }

//     } catch (error) {
//         console.error("\nError details:");
//         console.error(error);
//     }
// }

// main()
//     .then(() => process.exit(0))
//     .catch((error) => {
//         console.error("Top-level error:", error);
//         process.exit(1);
//     });
